@model IEnumerable<KosovaDoganaModerne.Modelet.Entitetet.ShpenzimiTransportit>

@{
    ViewData["Title"] = "Shpenzimet e Transportit - Raport";
    var vendiOrigjines = ViewData["VendiOrigjines"] as string;
    var vendiDestinacionit = ViewData["VendiDestinacionit"] as string;
    var llojiTransportit = ViewData["LlojiTransportit"] as string;
}

<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-truck"></i> Raporti i shpenzimeve të transportit</h2>
            <p class="text-muted mb-0">
                @if (!string.IsNullOrWhiteSpace(vendiOrigjines) || !string.IsNullOrWhiteSpace(vendiDestinacionit) || !string.IsNullOrWhiteSpace(llojiTransportit))
                {
                    if (!string.IsNullOrWhiteSpace(vendiOrigjines))
                    {
                        <text>Origjina: @vendiOrigjines </text>
                    }
                    if (!string.IsNullOrWhiteSpace(vendiDestinacionit))
                    {
                        <text>| Destinacioni: @vendiDestinacionit </text>
                    }
                    if (!string.IsNullOrWhiteSpace(llojiTransportit))
                    {
                        <text>| Transporti: @llojiTransportit</text>
                    }
                }
                else
                {
                    <text>Të gjitha shpenzimet</text>
                }
            </p>
        </div>
        <div>
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Kthehu
            </a>
            <a asp-action="ShpenzimetTransportit_Excel" asp-route-llojiTransportit="@ViewData["LlojiTransportit"]" class="btn btn-success">
                <i class="fas fa-file-excel"></i> Eksporto në Excel
            </a>
            <button onclick="window.print()" class="btn btn-secondary">
                <i class="fas fa-print"></i> Printo
            </button>
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-secondary">
                            <tr>
                                <th>Nr.</th>
                                <th>Origjina</th>
                                <th>Destinacioni</th>
                                <th>Lloji transportit</th>
                                <th>Çmimi/Njësi</th>
                                <th>Njësia</th>
                                <th>Valuta</th>
                                <th>Data e regjistrimit</th>
                                <th>Statusi</th>
                                <th>Ndryshime</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{ var nr = 1; }
                            @foreach (var shpenzim in Model.OrderBy(s => s.VendiOrigjines).ThenBy(s => s.VendiDestinacionit))
                            {
                                <tr>
                                    <td>@nr</td>
                                    <td><strong>@shpenzim.VendiOrigjines</strong></td>
                                    <td><strong>@shpenzim.VendiDestinacionit</strong></td>
                                    <td>
                                        @if (shpenzim.LlojiTransportit == "Tokësor")
                                        {
                                            <i class="fas fa-truck text-primary"></i>
                                        }
                                        else if (shpenzim.LlojiTransportit == "Ajror")
                                        {
                                            <i class="fas fa-plane text-info"></i>
                                        }
                                        else if (shpenzim.LlojiTransportit == "Detar")
                                        {
                                            <i class="fas fa-ship text-primary"></i>
                                        }
                                        else if (shpenzim.LlojiTransportit == "Hekurudhor")
                                        {
                                            <i class="fas fa-train text-secondary"></i>
                                        }
                                        @shpenzim.LlojiTransportit
                                    </td>
                                    <td class="text-end">@shpenzim.CmimiPerNjesi.ToString("N2")</td>
                                    <td>@shpenzim.NjesiaMatese</td>
                                    <td>@shpenzim.Valuta</td>
                                    <td>@shpenzim.DataKrijimit.ToString("dd/MM/yyyy")</td>
                                    <td>
                                        @if (shpenzim.Aktiv)
                                        {
                                            <span class="badge bg-success">Aktiv</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Joaktiv</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        @if (shpenzim.Ndryshimet != null && shpenzim.Ndryshimet.Any())
                                        {
                                            <span class="badge bg-info">@shpenzim.Ndryshimet.Count()</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                </tr>
                                nr++;
                            }
                        </tbody>
                        <tfoot>
                            <tr class="table-light">
                                <td colspan="10">
                                    <strong>Totali i shpenzimeve:</strong> @Model.Count() ruta transporti
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                @if (Model.Any(s => !string.IsNullOrWhiteSpace(s.Shenime)))
                {
                    <hr />
                    <h5>Shënime:</h5>
                    <ul class="list-group">
                        @foreach (var shpenzim in Model.Where(s => !string.IsNullOrWhiteSpace(s.Shenime)))
                        {
                            <li class="list-group-item">
                                <strong>@shpenzim.VendiOrigjines → @shpenzim.VendiDestinacionit:</strong>
                                @shpenzim.Shenime
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>

        <div class="mt-3">
            <small class="text-muted">
                Gjeneruar më: @DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss")
            </small>
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> Nuk ka shpenzime transporti për kriteret e zgjedhura.
        </div>
    }
</div>

<style>
    @@media print {
        .btn { display: none !important; }
        body { font-size: 12px; }
        .table { font-size: 11px; }
    }
</style>
